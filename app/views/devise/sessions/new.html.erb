<link rel="stylesheet" href="/assets/stylesheets/signinup">
<script src="/javascript/controllers/signinupform.js"></script>
<div id="login-form-wrapper" style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1000; background-color: lightgrey;">
  <div class="login-form-container" style="display: flex; justify-content: center; flex-direction: column; padding: 50px;">
    <%= simple_form_for(resource, as: resource_name, url: session_path(resource_name), html: { class: 'form' }, data: { turbo: :false }) do |f| %>

      <%= f.error_notification %>

      <div class="form-inputs">
        <div class="field required">
          <%= f.label :email %>
          <%= f.email_field :email, autofocus: true, autocomplete: "email", class: 'text-input', required: true %>
        </div>

        <div class="field required">
          <%= f.label :password %>
          <%= f.password_field :password, autocomplete: "current-password", class: 'text-input', required: true %>
        </div>

        <div class="form-actions" style="display: flex; flex-direction: column; justify-content: center;">
          <%= f.button :submit, "Log in", class: "button", style: "margin-bottom: 30px; width: 57%;" %>
          <button class="button", style="margin-bottom: 30px;">
            <%= link_to "Sign up", new_registration_path(resource_name) %>
            <style>
              a {
                color: white;
                text-decoration: none;
            }
            </style>
          <button class="button", style="width: 57%; text-align: center;">
            <%= link_to "Password", new_password_path(resource_name) %>
          </button>
        </div>
      </div>
    <% end %>
  </div>
</div>

<script>
  class magicFocus

    constructor: (@parent) ->

      return unless @parent

      @focus = document.createElement 'div'
      @focus.classList.add 'magic-focus'
      @parent.classList.add 'has-magic-focus'
      @parent.appendChild @focus

      for input in @parent.querySelectorAll('input, textarea, select')
        input.addEventListener 'focus', ->
          window.magicFocus.show()
        input.addEventListener 'blur', ->
          window.magicFocus.hide()

    show: =>

      return unless ['INPUT','SELECT','TEXTAREA'].includes? (el = document.activeElement).nodeName

      clearTimeout(@reset)

      el = document.querySelector("[for=#{el.id}]") if ['checkbox', 'radio'].includes? el.type

      @focus.style.top = "#{el.offsetTop||0}px"
      @focus.style.left = "#{el.offsetLeft||0}px"
      @focus.style.width = "#{el.offsetWidth||0}px"
      @focus.style.height = "#{el.offsetHeight||0}px"

    hide: =>

      @focus.style.width = 0 unless ['INPUT','SELECT','TEXTAREA', 'LABEL'].includes? (el = document.activeElement).nodeName

      @reset = setTimeout ->
        window.magicFocus.focus.removeAttribute('style')
      , 200

  # initialize

  window.magicFocus = new magicFocus document.querySelector('.div')

  $ ->
    $('.select').customSelect()

</script>
